<html><head><title>OTA Update</title>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f5f5f5;}
nav{background:#333;padding:10px 20px;display:flex;align-items:center;gap:18px;}
nav a{color:#fff;text-decoration:none;font-size:14px;padding:6px 12px;border-radius:4px;}
nav a:hover,nav a.active{background:#4CAF50;}
nav .brand{font-weight:bold;font-size:16px;margin-right:auto;color:#fff;}
.content{max-width:600px;margin:20px auto;padding:0 20px;}
h1{color:#333;}
.file-info{margin:10px 0;color:#555;font-size:14px;}
progress{width:100%;height:24px;display:none;margin:10px 0;border-radius:4px;overflow:hidden;}
progress::-webkit-progress-bar{background:#ddd;border-radius:4px;}
progress::-webkit-progress-value{background:#4CAF50;border-radius:4px;}
#status{margin:10px 0;font-size:14px;color:#333;white-space:pre-line;}
#uploadBtn{padding:8px 20px;background:#4CAF50;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:14px;}
#uploadBtn:disabled{background:#999;cursor:not-allowed;}
#uploadBtn:hover:not(:disabled){background:#45a049;}
.error{color:#d32f2f;}
.success{color:#2e7d32;}
</style></head><body>
<nav><span class='brand'>Goodman HP</span>
<a href='/'>Home</a>
<a href='/config'>Config</a>
<a href='/update' class='active'>Update</a>
<a href='/log'>Log</a>
</nav>
<div class='content'>
<h1>OTA Update</h1>
<input type='file' id='fileInput' accept='.bin'>
<div class='file-info' id='fileInfo'></div>
<button id='uploadBtn' disabled>Upload</button>
<progress id='progress' max='100' value='0'></progress>
<div id='status'></div>
</div>
<script>
var fileInput=document.getElementById('fileInput');
var uploadBtn=document.getElementById('uploadBtn');
var progress=document.getElementById('progress');
var status=document.getElementById('status');
var fileInfo=document.getElementById('fileInfo');

fileInput.addEventListener('change',function(){
  var f=fileInput.files[0];
  if(f){
    fileInfo.textContent=f.name+' ('+Math.round(f.size/1024)+' KB)';
    uploadBtn.disabled=false;
    status.textContent='';
    status.className='';
  }else{
    fileInfo.textContent='';
    uploadBtn.disabled=true;
  }
});

uploadBtn.addEventListener('click',function(){
  var f=fileInput.files[0];
  if(!f)return;
  uploadBtn.disabled=true;
  fileInput.disabled=true;
  progress.style.display='block';
  progress.value=0;
  status.textContent='Uploading...';
  status.className='';

  var xhr=new XMLHttpRequest();
  xhr.open('POST','/update',true);
  xhr.setRequestHeader('Content-Type','application/octet-stream');

  xhr.upload.onprogress=function(e){
    if(e.lengthComputable){
      var pct=Math.round(e.loaded/e.total*100);
      progress.value=pct;
      status.textContent='Uploading... '+pct+'%';
    }
  };

  xhr.onload=function(){
    if(xhr.status===200&&xhr.responseText==='OK'){
      progress.value=100;
      status.className='success';
      var sec=10;
      status.textContent='Upload complete! Rebooting in '+sec+'s...';
      var iv=setInterval(function(){
        sec--;
        if(sec<=0){
          clearInterval(iv);
          status.textContent='Reloading page...';
          location.reload();
        }else{
          status.textContent='Upload complete! Rebooting in '+sec+'s...';
        }
      },1000);
    }else{
      status.className='error';
      status.textContent='Update failed: '+(xhr.responseText||'Unknown error');
      uploadBtn.disabled=false;
      fileInput.disabled=false;
    }
  };

  xhr.onerror=function(){
    status.className='error';
    status.textContent='Upload failed: network error';
    uploadBtn.disabled=false;
    fileInput.disabled=false;
  };

  xhr.send(f);
});
</script>
</body></html>
