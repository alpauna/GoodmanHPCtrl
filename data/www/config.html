<html><head><title>Configuration</title>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f5f5f5;}
nav{background:#333;padding:10px 20px;display:flex;align-items:center;gap:18px;}
nav a{color:#fff;text-decoration:none;font-size:14px;padding:6px 12px;border-radius:4px;}
nav a:hover,nav a.active{background:#4CAF50;}
nav .brand{font-weight:bold;font-size:16px;margin-right:auto;}
.container{max-width:600px;margin:20px auto;padding:0 20px;}
h1{color:#333;}
fieldset{background:#fff;border:1px solid #ddd;border-radius:6px;padding:15px;margin-bottom:15px;}
legend{font-weight:bold;color:#4CAF50;padding:0 8px;}
label{display:block;margin:8px 0 3px;color:#555;font-size:14px;}
input[type=text],input[type=password],input[type=number]{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;}
.tag{font-size:11px;padding:2px 6px;border-radius:3px;margin-left:6px;color:#fff;}
.tag-reboot{background:#e67e22;}
.tag-live{background:#27ae60;}
button{background:#4CAF50;color:#fff;padding:10px 24px;border:none;border-radius:4px;cursor:pointer;font-size:16px;margin-top:10px;}
button:hover{background:#45a049;}
#status{margin-top:15px;padding:10px;border-radius:4px;display:none;}
.ok{background:#d4edda;color:#155724;display:block!important;}
.err{background:#f8d7da;color:#721c24;display:block!important;}
.info{background:#d1ecf1;color:#0c5460;display:block!important;}
</style></head><body>
<nav><span class='brand'>Goodman HP</span>
<a href='/'>Home</a>
<a href='/config' class='active'>Config</a>
<a href='/update'>Update</a>
<a href='/log'>Log</a>
</nav>
<div class='container'>
<h1>Configuration</h1>
<form id='cf' onsubmit='return save(event)'>
<fieldset><legend>WiFi <span class='tag tag-reboot'>reboot</span></legend>
<label>SSID</label><input type='text' id='wifiSSID'>
<label>Password</label><input type='password' id='wifiPassword'>
<label>Current Password (required to change)</label><input type='password' id='curWifiPw'>
</fieldset>
<fieldset><legend>MQTT <span class='tag tag-reboot'>reboot</span></legend>
<label>Host</label><input type='text' id='mqttHost'>
<label>Port</label><input type='number' id='mqttPort'>
<label>User</label><input type='text' id='mqttUser'>
<label>Password</label><input type='password' id='mqttPassword'>
<label>Current Password (required to change)</label><input type='password' id='curMqttPw'>
</fieldset>
<fieldset><legend>Timezone <span class='tag tag-live'>live</span></legend>
<label>GMT Offset (hours)</label><input type='number' step='0.5' id='gmtOffsetHrs'>
<label>Daylight Offset (hours)</label><input type='number' step='0.5' id='daylightOffsetHrs'>
</fieldset>
<fieldset><legend>Low Temp Protection <span class='tag tag-live'>live</span></legend>
<label>Threshold (&deg;F)</label><input type='number' step='0.1' id='lowTempThreshold'>
</fieldset>
<fieldset><legend>Logging <span class='tag tag-live'>live</span></legend>
<label>Max Log Size (bytes)</label><input type='number' id='maxLogSize'>
<label>Max Old Log Count</label><input type='number' id='maxOldLogCount'>
</fieldset>
<button type='submit'>Save</button>
</form>
<div id='status'></div>
</div>
<script>
var fields=['wifiSSID','wifiPassword','mqttHost','mqttPort','mqttUser','mqttPassword','gmtOffsetHrs','daylightOffsetHrs','lowTempThreshold','maxLogSize','maxOldLogCount'];
fetch('/config?format=json').then(r=>r.json()).then(d=>{
fields.forEach(f=>{var e=document.getElementById(f);if(e)e.value=d[f]!=null?d[f]:'';});
});
function save(e){
e.preventDefault();
var d={};fields.forEach(f=>{var e=document.getElementById(f);d[f]=e?e.value:'';});
d.curWifiPw=document.getElementById('curWifiPw').value;
d.curMqttPw=document.getElementById('curMqttPw').value;
var s=document.getElementById('status');
fetch('/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)}).then(r=>r.json()).then(r=>{
s.className=r.reboot?'info':r.error?'err':'ok';
s.textContent=r.message||r.error||'Saved';
s.style.display='block';
if(r.reboot){setTimeout(()=>{s.textContent='Rebooting... page will reload in 5s';setTimeout(()=>location.reload(),5000);},1000);}
document.getElementById('curWifiPw').value='';
document.getElementById('curMqttPw').value='';
}).catch(err=>{s.className='err';s.textContent='Error: '+err;s.style.display='block';});
return false;}
</script></body></html>
