<html><head><title>Configuration</title>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<link rel='stylesheet' href='/theme.css'>
<script>document.documentElement.dataset.theme=localStorage.getItem('hp-theme')||'dark'</script>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:var(--bg);}
nav{background:var(--nav-bg);padding:10px 20px;display:flex;align-items:center;gap:18px;}
nav a{color:#fff;text-decoration:none;font-size:14px;padding:6px 12px;border-radius:4px;}
nav a:hover,nav a.active{background:#4CAF50;}
nav .brand{font-weight:bold;font-size:16px;margin-right:auto;color:#fff;}
.container{max-width:600px;margin:20px auto;padding:0 20px;}
h1{color:var(--text);}
fieldset{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:15px;margin-bottom:15px;}
legend{font-weight:bold;color:#4CAF50;padding:0 8px;}
label{display:block;margin:8px 0 3px;color:var(--text-secondary);font-size:14px;}
input[type=text],input[type=password],input[type=number],select{width:100%;padding:8px;border:1px solid var(--input-border);border-radius:4px;box-sizing:border-box;background:var(--input-bg);color:var(--text);}
.tag{font-size:11px;padding:2px 6px;border-radius:3px;margin-left:6px;color:#fff;}
.tag-reboot{background:#e67e22;}
.tag-live{background:#27ae60;}
button{background:#4CAF50;color:#fff;padding:10px 24px;border:none;border-radius:4px;cursor:pointer;font-size:16px;margin-top:10px;}
button:hover{background:#45a049;}
.btn-sm{background:#4CAF50;color:#fff;padding:6px 16px;border:none;border-radius:4px;cursor:pointer;font-size:13px;margin:4px 4px 4px 0;}
.btn-sm:hover{background:#45a049;}
.btn-red{background:#e74c3c;}
.btn-red:hover{background:#c0392b;}
#status{margin-top:15px;padding:10px;border-radius:4px;display:none;}
.ok{background:#d4edda;color:#155724;display:block!important;}
.err{background:#f8d7da;color:#721c24;display:block!important;}
.info{background:#d1ecf1;color:#0c5460;display:block!important;}
#adminPwStatus{margin:8px 0;font-size:13px;padding:6px 10px;border-radius:4px;}
.pw-unset{background:#fff3cd;color:#856404;}
.pw-set{background:#d4edda;color:#155724;}
#ftpStatus{margin:8px 0;font-size:13px;padding:6px 10px;border-radius:4px;background:var(--code-bg);color:var(--text);}
</style></head><body>
<nav><span class='brand'>Goodman HP</span>
<a href='/'>Home</a>
<a href='/dashboard'>Dashboard</a>
<a href='/config' class='active'>Config</a>
<a href='/update'>Update</a>
<a href='/log/view'>Log</a>
<a href='/heap/view'>Heap</a>
<a href='#' onclick="if(confirm('Reboot device?')){fetch('/reboot',{method:'POST',headers:{'Authorization':'Basic '+btoa(prompt('user:pass','admin:'))}}).then(r=>r.ok?alert('Rebooting...'):alert('Failed'))};return false" style='margin-left:auto;background:#d32f2f;'>Reboot</a>
</nav>
<div class='container'>
<h1>Configuration</h1>
<form id='cf' onsubmit='return save(event)'>
<fieldset><legend>Appearance <span class='tag tag-live'>live</span></legend>
<label>Theme</label>
<select id='theme' onchange="document.documentElement.dataset.theme=this.value;localStorage.setItem('hp-theme',this.value);">
<option value='light'>Light</option>
<option value='dark'>Dark</option>
</select>
</fieldset>
<fieldset><legend>Admin Password</legend>
<div id='adminPwStatus'></div>
<label>New Password</label><input type='password' id='adminPassword'>
<label>Confirm Password</label><input type='password' id='adminPasswordConfirm'>
<div id='curAdminPwRow' style='display:none'>
<label>Current Password (required to change)</label><input type='password' id='curAdminPw'>
</div>
</fieldset>
<fieldset><legend>WiFi <span class='tag tag-reboot'>reboot</span></legend>
<label>SSID</label><input type='text' id='wifiSSID'>
<label>Password</label><input type='password' id='wifiPassword'>
<label>Current Password or Admin Password (required to change)</label><input type='password' id='curWifiPw'>
<a href='/wifi/view' class='btn-sm' style='display:inline-block;text-decoration:none;margin-top:8px;'>Scan WiFi</a>
</fieldset>
<fieldset><legend>MQTT <span class='tag tag-reboot'>reboot</span></legend>
<label>Host</label><input type='text' id='mqttHost'>
<label>Port</label><input type='number' id='mqttPort'>
<label>User</label><input type='text' id='mqttUser'>
<label>Password</label><input type='password' id='mqttPassword'>
<label>Current Password or Admin Password (required to change)</label><input type='password' id='curMqttPw'>
</fieldset>
<fieldset><legend>Timezone <span class='tag tag-live'>live</span></legend>
<label>GMT Offset (hours)</label><input type='number' step='0.5' id='gmtOffsetHrs'>
<label>Daylight Offset (hours)</label><input type='number' step='0.5' id='daylightOffsetHrs'>
</fieldset>
<fieldset><legend>Low Temp Protection <span class='tag tag-live'>live</span></legend>
<label>Threshold (&deg;F)</label><input type='number' step='0.1' id='lowTempThreshold'>
</fieldset>
<fieldset><legend>Logging <span class='tag tag-live'>live</span></legend>
<label>Max Log Size (MB)</label><input type='number' step='1' id='maxLogSizeMB'>
<label>Max Old Log Count</label><input type='number' id='maxOldLogCount'>
</fieldset>
<button type='submit'>Save</button>
</form>
<fieldset><legend>FTP Server</legend>
<div id='ftpStatus'>Loading...</div>
<button class='btn-sm' onclick='ftpControl(10)'>10 min</button>
<button class='btn-sm' onclick='ftpControl(30)'>30 min</button>
<button class='btn-sm' onclick='ftpControl(60)'>1 hour</button>
<button class='btn-sm btn-red' onclick='ftpControl(0)'>Off</button>
</fieldset>
<div id='status'></div>
</div>
<script>
var fields=['wifiSSID','wifiPassword','mqttHost','mqttPort','mqttUser','mqttPassword','gmtOffsetHrs','daylightOffsetHrs','lowTempThreshold','maxOldLogCount','theme'];
var adminPwSet=false;
fetch('/config?format=json').then(r=>r.json()).then(d=>{
fields.forEach(f=>{var e=document.getElementById(f);if(e)e.value=d[f]!=null?d[f]:'';});
document.getElementById('maxLogSizeMB').value=d.maxLogSize!=null?Math.round(d.maxLogSize/(1024*1024)):'';
adminPwSet=!!d.adminPasswordSet;
var st=document.getElementById('adminPwStatus');
if(adminPwSet){
st.className='pw-set';st.textContent='Password is set.';
document.getElementById('curAdminPwRow').style.display='block';
}else{
st.className='pw-unset';st.textContent='No password set \u2014 set one to secure this page and disable open FTP.';
}
// Apply loaded theme immediately
if(d.theme){document.documentElement.dataset.theme=d.theme;localStorage.setItem('hp-theme',d.theme);}
});
function save(e){
e.preventDefault();
var d={};fields.forEach(f=>{var e=document.getElementById(f);d[f]=e?e.value:'';});
var mbVal=document.getElementById('maxLogSizeMB').value;
d.maxLogSize=mbVal?parseInt(mbVal)*1024*1024:'';
d.curWifiPw=document.getElementById('curWifiPw').value;
d.curMqttPw=document.getElementById('curMqttPw').value;
var ap=document.getElementById('adminPassword').value;
var apc=document.getElementById('adminPasswordConfirm').value;
if(ap.length>0){
if(ap!==apc){var s=document.getElementById('status');s.className='err';s.textContent='Admin passwords do not match.';s.style.display='block';return false;}
d.adminPassword=ap;
d.curAdminPw=document.getElementById('curAdminPw').value;
}
var s=document.getElementById('status');
fetch('/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)}).then(r=>r.json()).then(r=>{
s.className=r.reboot?'info':r.error?'err':'ok';
s.textContent=r.message||r.error||'Saved';
s.style.display='block';
if(r.reboot){setTimeout(()=>{s.textContent='Rebooting... page will reload in 5s';setTimeout(()=>location.reload(),5000);},1000);}
document.getElementById('curWifiPw').value='';
document.getElementById('curMqttPw').value='';
document.getElementById('adminPassword').value='';
document.getElementById('adminPasswordConfirm').value='';
document.getElementById('curAdminPw').value='';
if(ap.length>0&&!r.error){adminPwSet=true;document.getElementById('adminPwStatus').className='pw-set';document.getElementById('adminPwStatus').textContent='Password is set.';document.getElementById('curAdminPwRow').style.display='block';loadFtpStatus();}
// Apply theme change immediately
var newTheme=document.getElementById('theme').value;
document.documentElement.dataset.theme=newTheme;
localStorage.setItem('hp-theme',newTheme);
}).catch(err=>{s.className='err';s.textContent='Error: '+err;s.style.display='block';});
return false;}
function ftpControl(mins){
fetch('/ftp',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({duration:mins})}).then(r=>r.json()).then(r=>{
if(r.error){alert(r.error);}
loadFtpStatus();
}).catch(err=>alert('Error: '+err));
}
function loadFtpStatus(){
fetch('/ftp').then(r=>r.json()).then(d=>{
var el=document.getElementById('ftpStatus');
if(d.active){
el.textContent=d.remainingMinutes>0?'Active ('+d.remainingMinutes+' min remaining)':'Active (unlimited)';
el.style.background='#d4edda';el.style.color='#155724';
}else{
el.textContent='Inactive';
el.style.background='';el.style.color='';
}
}).catch(()=>{document.getElementById('ftpStatus').textContent='Error loading status';});
}
loadFtpStatus();
setInterval(loadFtpStatus,30000);
</script></body></html>
